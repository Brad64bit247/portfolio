<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=chteh0fSOiSrmusp8u43YAdDjahd2IAEL5IFmyNQJ7o');.lst-kix_4sj89tpcmap3-3>li:before{content:"\0025cf  "}.lst-kix_pyovtw4wzaab-8>li:before{content:"\0025a0  "}.lst-kix_pyovtw4wzaab-7>li:before{content:"\0025cb  "}.lst-kix_4sj89tpcmap3-2>li:before{content:"\0025a0  "}.lst-kix_4sj89tpcmap3-6>li:before{content:"\0025cf  "}.lst-kix_4sj89tpcmap3-5>li:before{content:"\0025a0  "}.lst-kix_4sj89tpcmap3-4>li:before{content:"\0025cb  "}.lst-kix_pyovtw4wzaab-2>li:before{content:"\0025a0  "}.lst-kix_pyovtw4wzaab-3>li:before{content:"\0025cf  "}.lst-kix_4sj89tpcmap3-7>li:before{content:"\0025cb  "}.lst-kix_pyovtw4wzaab-5>li:before{content:"\0025a0  "}.lst-kix_pyovtw4wzaab-4>li:before{content:"\0025cb  "}.lst-kix_pyovtw4wzaab-6>li:before{content:"\0025cf  "}.lst-kix_4sj89tpcmap3-8>li:before{content:"\0025a0  "}ul.lst-kix_4sj89tpcmap3-1{list-style-type:none}ul.lst-kix_4sj89tpcmap3-2{list-style-type:none}ul.lst-kix_4sj89tpcmap3-0{list-style-type:none}ul.lst-kix_4sj89tpcmap3-5{list-style-type:none}ul.lst-kix_4sj89tpcmap3-6{list-style-type:none}.lst-kix_jb1xcdfhmw2t-8>li:before{content:"\0025a0  "}ul.lst-kix_4sj89tpcmap3-3{list-style-type:none}ul.lst-kix_4sj89tpcmap3-4{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-5{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-6{list-style-type:none}ul.lst-kix_4sj89tpcmap3-7{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-3{list-style-type:none}ul.lst-kix_4sj89tpcmap3-8{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-4{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-7{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-8{list-style-type:none}.lst-kix_pyovtw4wzaab-1>li:before{content:"\0025cb  "}.lst-kix_pyovtw4wzaab-0>li:before{content:"\0025cf  "}ul.lst-kix_jb1xcdfhmw2t-1{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-2{list-style-type:none}ul.lst-kix_jb1xcdfhmw2t-0{list-style-type:none}.lst-kix_4sj89tpcmap3-1>li:before{content:"\0025cb  "}.lst-kix_4sj89tpcmap3-0>li:before{content:"\0025cf  "}.lst-kix_n6jbnsuro4v5-7>li:before{content:"\0025cb  "}.lst-kix_n6jbnsuro4v5-8>li:before{content:"\0025a0  "}.lst-kix_n6jbnsuro4v5-6>li:before{content:"\0025cf  "}ul.lst-kix_pyovtw4wzaab-7{list-style-type:none}.lst-kix_jb1xcdfhmw2t-2>li:before{content:"\0025a0  "}ul.lst-kix_pyovtw4wzaab-8{list-style-type:none}.lst-kix_n6jbnsuro4v5-3>li:before{content:"\0025cf  "}.lst-kix_n6jbnsuro4v5-4>li:before{content:"\0025cb  "}.lst-kix_jb1xcdfhmw2t-3>li:before{content:"\0025cf  "}ul.lst-kix_pyovtw4wzaab-3{list-style-type:none}.lst-kix_jb1xcdfhmw2t-4>li:before{content:"\0025cb  "}ul.lst-kix_pyovtw4wzaab-4{list-style-type:none}.lst-kix_n6jbnsuro4v5-1>li:before{content:"\0025cb  "}.lst-kix_n6jbnsuro4v5-5>li:before{content:"\0025a0  "}ul.lst-kix_pyovtw4wzaab-5{list-style-type:none}ul.lst-kix_pyovtw4wzaab-6{list-style-type:none}.lst-kix_jb1xcdfhmw2t-6>li:before{content:"\0025cf  "}.lst-kix_jb1xcdfhmw2t-5>li:before{content:"\0025a0  "}.lst-kix_jb1xcdfhmw2t-7>li:before{content:"\0025cb  "}.lst-kix_qrnpqbk6zwox-7>li:before{content:"\0025cb  "}.lst-kix_n6jbnsuro4v5-2>li:before{content:"\0025a0  "}.lst-kix_qrnpqbk6zwox-8>li:before{content:"\0025a0  "}.lst-kix_qrnpqbk6zwox-5>li:before{content:"\0025a0  "}ul.lst-kix_n6jbnsuro4v5-0{list-style-type:none}ul.lst-kix_n6jbnsuro4v5-1{list-style-type:none}ul.lst-kix_n6jbnsuro4v5-2{list-style-type:none}.lst-kix_qrnpqbk6zwox-2>li:before{content:"\0025a0  "}.lst-kix_qrnpqbk6zwox-6>li:before{content:"\0025cf  "}ul.lst-kix_n6jbnsuro4v5-7{list-style-type:none}ul.lst-kix_pyovtw4wzaab-0{list-style-type:none}.lst-kix_n6jbnsuro4v5-0>li:before{content:"\0025cf  "}ul.lst-kix_n6jbnsuro4v5-8{list-style-type:none}ul.lst-kix_pyovtw4wzaab-1{list-style-type:none}ul.lst-kix_pyovtw4wzaab-2{list-style-type:none}ul.lst-kix_n6jbnsuro4v5-3{list-style-type:none}.lst-kix_qrnpqbk6zwox-3>li:before{content:"\0025cf  "}ul.lst-kix_n6jbnsuro4v5-4{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_n6jbnsuro4v5-5{list-style-type:none}.lst-kix_qrnpqbk6zwox-4>li:before{content:"\0025cb  "}ul.lst-kix_n6jbnsuro4v5-6{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-8{list-style-type:none}.lst-kix_jb1xcdfhmw2t-1>li:before{content:"\0025cb  "}ul.lst-kix_qrnpqbk6zwox-6{list-style-type:none}.lst-kix_jb1xcdfhmw2t-0>li:before{content:"\0025cf  "}ul.lst-kix_qrnpqbk6zwox-7{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-4{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-5{list-style-type:none}.lst-kix_qrnpqbk6zwox-1>li:before{content:"\0025cb  "}ul.lst-kix_qrnpqbk6zwox-2{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-3{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-0{list-style-type:none}ul.lst-kix_qrnpqbk6zwox-1{list-style-type:none}.lst-kix_qrnpqbk6zwox-0>li:before{content:"\0025cf  "}ol{margin:0;padding:0}table td,table th{padding:0}.c10{background-color:#ffffff;color:#6a737d;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Consolas";font-style:normal}.c5{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:17pt;font-family:"Arial";font-style:normal}.c17{background-color:#ffffff;padding-top:0pt;padding-bottom:15pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c20{color:#505050;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c14{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c22{background-color:#ffffff;padding-top:0pt;padding-bottom:34pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:italic}.c12{color:#333333;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Open Sans";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c21{padding-top:18pt;padding-bottom:4pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c25{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c23{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial"}.c30{background-color:#ffffff;font-size:9pt;font-family:"Consolas";color:#6a737d;font-weight:400}.c28{background-color:#ffffff;font-size:9pt;font-family:"Consolas";color:#24292e;font-weight:400}.c29{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{background-color:#ffffff;font-style:italic;color:#505050}.c9{margin-left:36pt;padding-left:0pt}.c13{font-weight:700;font-style:italic}.c15{background-color:#ffffff;color:#505050}.c8{padding:0;margin:0}.c19{font-style:italic}.c26{font-size:11.5pt}.c27{color:#505050}.c2{height:11pt}.c16{font-weight:700}.c7{font-size:8pt}.c31{color:#ff0000}.c3{font-size:12pt}.c24{font-size:17pt}.c11{margin-left:36pt}.c18{font-size:13.5pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c29"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 471.50px; height: 310.56px;"><img alt="" src="images/image2.png" style="width: 471.50px; height: 310.56px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c16 c24">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c25 c7">Figure 1</span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1"><span class="c16 c24">Jigsaw Ransomware Analysis </span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">In this blog we are analyzing Jigsaw ransomware through both static and dynamic approaches with the end goal of finding the kill switch, and uncovering the decryption key. The two disciplines contained within the canopy of ransomware analyses are static and dynamic.</span></p><p class="c1"><span class="c0">Static analyses is the process of reviewing the source code and structure or flow of the binary to learn its intended behaviors and various functions. During this time the binary has not been executed. Dynamic analyses on the other hand requires us to execute or launch the malware, to perform live analyses during run time of the processes, services and system modifications.</span></p><p class="c1 c2"><span class="c0"></span></p><h2 class="c21" id="h.s3zia4lu5a0q"><span class="c5">A little about Jigsaw Ransomware</span></h2><p class="c1"><span class="c0">This malicious and clever software is named after the character from the horror movie Saw. By deleting files every hour for the first 24 hours this ransomware is unique to other variants which routinely just encrypt your files and request a payment at your earliest convenience. &nbsp;Jigsaw applies further pressure by threatening to delete 1000 files if the system should be restarted, or the process modified. </span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 404.00px; height: 146.00px;"><img alt="" src="images/image3.png" style="width: 404.00px; height: 146.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 2</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">Further, instead of the regular ransomware instructions on how to make payments with crypto currency and a user friendly step by step guide, Jigsaw only provides a link on where to obtain Crypto Currency.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p><h2 class="c21" id="h.t5wnysb8nn1l"><span class="c5">Tools used</span></h2><ul class="c8 lst-kix_jb1xcdfhmw2t-0 start"><li class="c1 c9 li-bullet-0"><span>Ghidra - Decompile .Net</span></li><li class="c1 c9 li-bullet-0"><span>Glasswire - </span><span class="c23 c19">Live network connection monitoring</span></li><li class="c1 c9 li-bullet-0"><span>Watch4 folder - </span><span class="c19">Live file monitoring</span><span>&nbsp;</span></li><li class="c1 c9 li-bullet-0"><span>WireShark - </span><span class="c23 c19">Network traffic monitoring</span></li><li class="c1 c9 li-bullet-0"><span>Hybrid Analyses -</span><span class="c23 c19">&nbsp;Sandboxing</span></li><li class="c1 c9 li-bullet-0"><span>Dotpeek - </span><span class="c23 c19">Decompile .NET </span></li></ul><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><h2 class="c21" id="h.o00st6mp7yzt"><span class="c5">Static Analyses - Jigsaw Ransomware</span></h2><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c16">1. </span><span class="c4">Headers</span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c0">Headers indicate the file is a PE32 that was packed with Morphine v1.2 and may contain obfuscation to help hide itself or its dropped files.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 170.67px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 170.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 3</span></p><p class="c1"><span class="c4">2. Antivirus scanning</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">Windows defender recognised the virus immediately when we unzipped the file. Total virus shows us this is a recognized threat.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 415.39px; height: 276.21px;"><img alt="" src="images/image6.png" style="width: 415.39px; height: 276.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c16">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 4</span></p><p class="c1 c2"><span class="c14"></span></p><p class="c1"><span class="c4">3. Hashing</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">A widely adopted technique to identify malware is by generating a unique hash. This hash is specific to a file and provides authenticity of suspected malware.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 585.00px; height: 84.00px;"><img alt="" src="images/image4.png" style="width: 585.00px; height: 84.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 5</span></p><p class="c1"><span class="c0">The following are hashes for other variants and related files</span></p><p class="c1 c2"><span class="c0"></span></p><ul class="c8 lst-kix_n6jbnsuro4v5-0 start"><li class="c22 c9 li-bullet-0"><span class="c12">0C269C5A641FD479269C2F353841A5BF9910888B &ndash; Ransom_JIGSAW.A</span></li><li class="c22 c9 li-bullet-0"><span class="c12">DC307A673AA5EECB5C1400F1D342E03697564F98 &ndash; Ransom_JIGSAW.A</span></li><li class="c22 c9 li-bullet-0"><span class="c12">CE42E2C694CA4737AE68D3C9E333554C55AFEE27 &ndash; Ransom_JIGSAW.A</span></li><li class="c22 c9 li-bullet-0"><span class="c12">1AD9F8695C10ADB69BDEBD6BDC39B119707D500E &ndash; Ransom_JIGSAW.B</span></li><li class="c22 c9 li-bullet-0"><span class="c12">CA40233610D40258539DA0212A06AF29B07C13F6 &ndash; Ransom_JIGSAW.C</span></li><li class="c22 c9 li-bullet-0"><span class="c12">F8431CF0A73E4EDE5B4B38185D73D8472CFE2AE7 &ndash; Ransom_JIGSAW.C</span></li><li class="c22 c9 li-bullet-0"><span class="c12">DCE911B1C05DA965C8733935723B88BC29D12756 &ndash; Ransom_JIGSAW.D</span></li><li class="c22 c9 li-bullet-0"><span class="c12">3F6E3E5126C837F46A18EE988DBF5756C2B856AA &ndash; Ransom_JIGSAW.E</span></li><li class="c9 c22 li-bullet-0"><span class="c12">92620194A581A91874A5284A775014E0D71A9DB1 &ndash; Ransom_JIGSAW.E</span></li></ul><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c4">4. Packer/compiler detection</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">Majority of malware is completely or partially packed as a means to obfuscate itself from signature based detections, while concealing hidden .exe or files within. Some of the common packers are UPX, Morphine and MEW. Packers are a form of obfuscation and this largely puts the responsibility on antivirus software to maintain and update their database with packer related signatures and behaviours. Some historical packers have been able to bypass detection all together such as Armadillo, Shrinker, Cexe and Epack. These packers can inevitably live on a system and continually unpack malware while never allowing the EDR to remove the root cause. You can see below that Morhpine v1.2 was identified as the packer, just like we noticed in the header.</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 400.00px; height: 106.00px;"><img alt="" src="images/image10.png" style="width: 400.00px; height: 106.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 6</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c4">5. Decompile</span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c0">While decompiling this binary the encryption key was stored in plain text within the binary. This allows for possible decryption of the ransomware if the encryption process and algorithm can be first identified.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 273.33px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 273.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c25 c7">Figure 7</span></p><p class="c1 c2"><span class="c25 c7"></span></p><p class="c1"><span class="c0">Further investigation shows us the AES Crypto Service Provider is called which suggests our ransomware is using AES and we can simply convert our key from text into binary to determine the key length which results in 192 bits.</span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 323.00px; height: 177.00px;"><img alt="" src="images/image7.png" style="width: 323.00px; height: 177.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c16 c24">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 8</span></p><h2 class="c1" id="h.bufuj23a16pr"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 404.74px; height: 392.50px;"><img alt="" src="images/image5.png" style="width: 404.74px; height: 392.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></h2><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 9</span></p><h2 class="c21" id="h.oisxx85hlgce"><span class="c5">Dynamic Analyses - Jigsaw Ransomware</span></h2><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c4">1. Dropped files</span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c0">Generally speaking malware drops various files during runtime and this can provide as a vehicle to gaining deeper insight into binary behaviours and processes. &nbsp; Monitoring for file writes and changes during dynamic analyses will provide a list of dropped files. In the list below we can see that many files were dropped. </span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 433.00px; height: 296.00px;"><img alt="" src="images/image8.png" style="width: 433.00px; height: 296.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c25 c7">Figure 10</span></p><p class="c1 c2"><span class="c7 c25"></span></p><p class="c1"><span>The file that immediately stands out is &nbsp;</span><span class="c31">&ldquo;The DisableWindowsFirewall.cpp&rdquo; </span><span class="c0">&nbsp;a c++ binary that imports the windows netfw.h header providing control over the windows firewall application. </span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c11"><span class="c10">// Disable Windows Firewall for the Domain profile</span></p><p class="c1 c11"><span class="c28">hr = pNetFwPolicy2-&gt;</span><span class="c30">put_FirewallEnabled</span><span class="c28">(NET_FW_PROFILE2_DOMAIN, </span><span class="c30">FALSE</span><span class="c28">);</span></p><p class="c1 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 168.00px;"><img alt="" src="images/image13.png" style="width: 624.00px; height: 168.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c27">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure 11</span></p><p class="c17"><span class="c20">The program appears to copy itself to the following location disguising itself as a legitimate program.</span></p><p class="c17"><span class="c20">%AppData$\Roaming\Frfx\firefox.exe</span></p><p class="c17"><span class="c20">AppData\Local\Drpbx\drpbx.exe</span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c13">2. Network</span></p><p class="c1 c2 c11"><span class="c0"></span></p><p class="c1"><span class="c0">This URL was also found during run time which is probably related to the command and control server which is no longer present. In some cases Jigsaw ransomware also included the Athena malware to allow for remote control of the target device.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c6">http://demourl.co.nf/pwd/write.php?info=PC-admin%20cEpFtlMNwZUsZLNuGPQTiT==</span><span class="c23 c19">&nbsp;</span></p><p class="c1 c2"><span class="c4"></span></p><p class="c1"><span class="c0">Wireshark showed us a query to a bitcoin wallet upon requesting file decryption. The ransomware is continually pinging this address to determine if &nbsp;a bitcoin deposit has been made, in which case your files will be unlocked.</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 413.36px; height: 25.10px;"><img alt="" src="images/image14.png" style="width: 413.36px; height: 25.10px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c25 c7">Figure 12</span></p><p class="c1 c2"><span class="c25 c7"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 423.05px; height: 38.46px;"><img alt="" src="images/image1.png" style="width: 423.05px; height: 38.46px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7">Figure13</span></p><p class="c1 c2"><span class="c4"></span></p><p class="c1"><span class="c4">3. Processes</span></p><p class="c1 c2"><span class="c4"></span></p><p class="c1"><span class="c0">We observed jigsaw spawned drpbox.exe and terminated the parent process shortly after to hide its tracks.</span></p><p class="c1 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 394.00px; height: 80.00px;"><img alt="" src="images/image11.png" style="width: 394.00px; height: 80.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c4">4. Registry changes</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">The following registry keys were changed in order to establish persistence on startup and reboots.</span></p><p class="c1 c2"><span class="c4"></span></p><p class="c1"><span class="c15">HKCU\Software\Microsoft\Windows\CurrentVersion\Run &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firefox.exe=C:\Users\admin.admin-PC\AppData\Roaming\Frfx\firefox.exe &nbsp; </span><span class="c15 c16 c26">&nbsp; &nbsp;</span><span class="c15 c16 c18">&nbsp; &nbsp;</span></p><p class="c1 c2"><span class="c5"></span></p><p class="c1"><span class="c5">SIEM Use Case Alerts / Detection</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">Two very common .dll&rsquo;s within windows ransomware are CRYPTBASE.dll and CRYPTSP.dll. Use cases can be created to monitor for the use of these .ddl in a binary. </span></p><p class="c1"><span class="c0">Monitoring for file names with known ransomware extensions can prove invaluable as well.</span></p></body></html>